{"remainingRequest":"/Users/wangluna/wln/vueSpace/vue-ergeng/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangluna/wln/vueSpace/vue-ergeng/src/views/index/search.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangluna/wln/vueSpace/vue-ergeng/src/views/index/search.vue","mtime":1561897486095},{"path":"/Users/wangluna/wln/vueSpace/vue-ergeng/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangluna/wln/vueSpace/vue-ergeng/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangluna/wln/vueSpace/vue-ergeng/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangluna/wln/vueSpace/vue-ergeng/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport axios from 'axios'\nimport { constants } from 'fs';\n\nexport default {\n  name: \"search\",\n  components:{\n    // headtitle\n  },\n  data: function(){\n      return {\n        placeholder:'搜索视频',\n        query:'',\n        queryResult: [],\n        hasResult: false,\n        page:1,\n        size:2,\n        seaHis:[],\n        userInfo:{}\n      }\n  },\n  watch:{\n    query(){\n        if(this.query == ''){\n            this.hasResult = false;\n            this.queryResult =[];\n            return;\n        }\n        axios\n        .get('http://iot.smart-ideas.com.cn/ssgy/lnVideo/list/'+this.page+'/'+this.size,{\n            params: {\n                videoName: this.query\n            }\n        })\n        .then((res)=>{\n            this.queryResult =[];\n            var data = res.data;\n            this.hasResult = true;\n            var list = data.queryResult.list;\n            var resList = this.queryResult;\n            for(var key in list){\n                resList.push(list[key]);\n            }\n            this.queryResult = resList;\n        })\n        .catch((err) => {\n            console.log(err)\n        })\n    }\n  },\n  mounted(){\n      if(this.$store.state.userinfo){\n        this.userInfo.userId = JSON.parse(this.$store.state.userinfo).userId;\n        this.initHistory(this.userInfo.userId);\n      }else{\n        this.initHistory('tourists');\n      }\n  },\n  methods:{\n    initHistory(userId){\n        var seaHis = window.sessionStorage.getItem('seaHis') ? JSON.parse(window.sessionStorage.getItem('seaHis')) : '';\n        if(seaHis == '' || seaHis == 'undefined'){\n            return;\n        }else{\n            this.showHistory(userId);\n        }\n    },\n    toDetail(videoId){\n        var obj ={}\n        if(this.userInfo.userId){//userId存在，说明用户已登录\n            obj = {userId: this.userInfo.userId, name: this.query};\n        }else{//userId不存在，说明用户是游客状态\n            obj ={userId: 'tourists', name: this.query}\n        }\n        //点击搜索结果时判断是否存储搜索记录\n        var seaHis = JSON.parse(window.sessionStorage.getItem('seaHis')) || '';\n        //定义是否存储状态 true：存储 \n        var isStorage = true;\n        var arr = [];\n        \n        for(var key in seaHis){\n            //搜索记录相同时 存储状态改为false\n            if(seaHis[key].name == obj.name){\n                isStorage = false;\n                break;\n            }\n            arr.push(seaHis[key])\n        }\n        //根据存储状态来判断是否存储\n        if(isStorage){\n            arr.unshift(obj);\n            window.sessionStorage.setItem('seaHis',JSON.stringify(arr));\n        }\n        this.$router.push({path:'/detail', query: {id: videoId}})\n\n    },\n    showHistory(userId){\n        // console.log('showHistory  id= ' + userId)\n        var searchHistory = JSON.parse(window.sessionStorage.getItem('seaHis'));\n        var arr = [];\n        for(var key in searchHistory){\n            if(searchHistory[key].userId === userId){\n                arr.push(searchHistory[key])\n            }\n        }\n        this.seaHis = arr;\n\n    },\n    historyHandler(name){\n        this.query = name;\n    },\n    delHistory(){\n        window.sessionStorage.removeItem('seaHis');\n        this.showHistory();\n    },\n    onCancle(){\n        this.$router.go(-1);\n    }\n\n  }\n};\n",{"version":3,"sources":["search.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"search.vue","sourceRoot":"src/views/index","sourcesContent":["<template>\n    <div class=\"search-page\">\n        <div class=\"search-box\">\n            <input class=\"search-input\" :placeholder=\"placeholder\" v-model.trim=\"query\" type=\"text\">\n            <span class=\"search-cancle\" @click=\"onCancle()\">取消</span>\n        </div>\n        <ul class=\"hot-list\"  v-show=\"!hasResult\">\n            <div>热门搜索</div>\n            <ul>    \n                <li class=\"hot-item\"><span>美食</span></li>\n                <li class=\"hot-item\"><span>地铁枢纽</span></li>\n            </ul>\n        </ul>\n        <ul class=\"result-list\" v-show=\"hasResult\">\n            <li  class=\"result-item\" v-for=\"(item) in queryResult\" :key=\"item.id\" @click=\"toDetail(item.id)\">\n                {{item.videoName}}\n            </li>\n        </ul>\n        <!-- -->\n        <div v-if=\"seaHis.length>0\">\n            <ul class=\"hot-list\"  v-show=\"!hasResult\">\n                <div>搜索历史 <img class=\"del\" src=\"@/assets/images/del.png\" @click=\"delHistory()\" alt=\"\"> </div>\n                <ul>   \n                    <li class=\"hot-item\" v-for=\"(item,index) in seaHis\" :key=\"index\" @click=\"historyHandler(item.name)\">\n                        <span>{{item.name}}</span>    \n                    </li> \n                </ul>\n            </ul>\n        </div>\n    </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport { constants } from 'fs';\n\nexport default {\n  name: \"search\",\n  components:{\n    // headtitle\n  },\n  data: function(){\n      return {\n        placeholder:'搜索视频',\n        query:'',\n        queryResult: [],\n        hasResult: false,\n        page:1,\n        size:2,\n        seaHis:[],\n        userInfo:{}\n      }\n  },\n  watch:{\n    query(){\n        if(this.query == ''){\n            this.hasResult = false;\n            this.queryResult =[];\n            return;\n        }\n        axios\n        .get('http://iot.smart-ideas.com.cn/ssgy/lnVideo/list/'+this.page+'/'+this.size,{\n            params: {\n                videoName: this.query\n            }\n        })\n        .then((res)=>{\n            this.queryResult =[];\n            var data = res.data;\n            this.hasResult = true;\n            var list = data.queryResult.list;\n            var resList = this.queryResult;\n            for(var key in list){\n                resList.push(list[key]);\n            }\n            this.queryResult = resList;\n        })\n        .catch((err) => {\n            console.log(err)\n        })\n    }\n  },\n  mounted(){\n      if(this.$store.state.userinfo){\n        this.userInfo.userId = JSON.parse(this.$store.state.userinfo).userId;\n        this.initHistory(this.userInfo.userId);\n      }else{\n        this.initHistory('tourists');\n      }\n  },\n  methods:{\n    initHistory(userId){\n        var seaHis = window.sessionStorage.getItem('seaHis') ? JSON.parse(window.sessionStorage.getItem('seaHis')) : '';\n        if(seaHis == '' || seaHis == 'undefined'){\n            return;\n        }else{\n            this.showHistory(userId);\n        }\n    },\n    toDetail(videoId){\n        var obj ={}\n        if(this.userInfo.userId){//userId存在，说明用户已登录\n            obj = {userId: this.userInfo.userId, name: this.query};\n        }else{//userId不存在，说明用户是游客状态\n            obj ={userId: 'tourists', name: this.query}\n        }\n        //点击搜索结果时判断是否存储搜索记录\n        var seaHis = JSON.parse(window.sessionStorage.getItem('seaHis')) || '';\n        //定义是否存储状态 true：存储 \n        var isStorage = true;\n        var arr = [];\n        \n        for(var key in seaHis){\n            //搜索记录相同时 存储状态改为false\n            if(seaHis[key].name == obj.name){\n                isStorage = false;\n                break;\n            }\n            arr.push(seaHis[key])\n        }\n        //根据存储状态来判断是否存储\n        if(isStorage){\n            arr.unshift(obj);\n            window.sessionStorage.setItem('seaHis',JSON.stringify(arr));\n        }\n        this.$router.push({path:'/detail', query: {id: videoId}})\n\n    },\n    showHistory(userId){\n        // console.log('showHistory  id= ' + userId)\n        var searchHistory = JSON.parse(window.sessionStorage.getItem('seaHis'));\n        var arr = [];\n        for(var key in searchHistory){\n            if(searchHistory[key].userId === userId){\n                arr.push(searchHistory[key])\n            }\n        }\n        this.seaHis = arr;\n\n    },\n    historyHandler(name){\n        this.query = name;\n    },\n    delHistory(){\n        window.sessionStorage.removeItem('seaHis');\n        this.showHistory();\n    },\n    onCancle(){\n        this.$router.go(-1);\n    }\n\n  }\n};\n</script>\n<style lang=\"less\" scoped>\n   .search-page{\n       padding:10px 15px 0;\n       .search-box{\n           background: #f1f3f5;\n           padding: 5px;\n           display: flex;\n           .search-input{\n               height: 30px;\n               line-height: 30px;\n               display: block;\n               padding-left: 50px;\n               flex: 1;\n               background:#fff url(http://www.ruyutrip.com/img/mb_v2/list_icon.png)no-repeat 10px center;\n               background-size: 15px 15px;\n               &:focus{\n                   outline: none\n               }\n           }\n           .search-cancle{\n               height: 30px;\n               line-height: 30px;\n               width:80px;\n               text-align: center;\n               color:#333;\n           }\n       }\n       .hot-list{\n           overflow: hidden;\n           padding-top: 30px;\n           div{\n               font-size: 16px;\n               padding-bottom: 20px;\n               .del{\n                   width:16px;\n                   height:16px;\n                   float: right;\n                   margin-top:5px;\n               }\n           }\n           .hot-item{\n               display:inline-block;\n               line-height: 22px;\n               padding:3px 10px;\n               background: #eee;\n               margin-right: 15px;\n               color:#999;\n               border-radius: 4px;\n               margin-bottom: 5px;\n           }\n       }\n       .result-list{\n           .result-item{\n               height: 46px;\n               line-height: 46px;\n               border-bottom: 1px solid #eee;\n               overflow: hidden;\n                text-overflow:ellipsis;\n                white-space: nowrap;\n           }\n       }\n   }\n</style>\n"]}]}