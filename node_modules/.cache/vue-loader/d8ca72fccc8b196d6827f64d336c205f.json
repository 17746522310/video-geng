{"remainingRequest":"/Users/wangluna/wln/vueSpace/vue-ergeng/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangluna/wln/vueSpace/vue-ergeng/src/views/index/search.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangluna/wln/vueSpace/vue-ergeng/src/views/index/search.vue","mtime":1561992892670},{"path":"/Users/wangluna/wln/vueSpace/vue-ergeng/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangluna/wln/vueSpace/vue-ergeng/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangluna/wln/vueSpace/vue-ergeng/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangluna/wln/vueSpace/vue-ergeng/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangluna/wln/vueSpace/vue-ergeng/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport axios from 'axios'\nimport { constants } from 'fs';\nimport myDialog from '@/components/confirm.vue'\nimport * as apiUrl from \"@/common/apiUrl.js\";\n\nexport default {\n  name: \"search\",\n  components:{\n    // headtitle\n    myDialog\n  },\n  data: function(){\n      return {\n        placeholder:'搜索视频',\n        query:'',\n        queryResult: [],\n        hasResult: false,\n        page:1,\n        size:2,\n        seaHis:[],\n        userInfo:{},\n        confirmOptions:{\n\n        }\n      }\n  },\n  watch:{\n    query(){\n        if(this.query == ''){\n            this.hasResult = false;\n            this.queryResult =[];\n            return;\n        }\n        axios\n        .get(apiUrl.api_test_url+'lnVideo/list/'+this.page+'/'+this.size,{\n            params: {\n                videoName: this.query\n            }\n        })\n        .then((res)=>{\n            this.queryResult =[];\n            var data = res.data;\n            this.hasResult = true;\n            var list = data.queryResult.list;\n            var resList = this.queryResult;\n            for(var key in list){\n                resList.push(list[key]);\n            }\n            this.queryResult = resList;\n        })\n        .catch((err) => {\n            console.log(err)\n        })\n    }\n  },\n  mounted(){\n      if(this.$store.state.userinfo){\n        this.userInfo.userId = JSON.parse(this.$store.state.userinfo).userId;\n        this.initHistory(this.userInfo.userId);\n      }else{\n        this.initHistory('tourists');\n      }\n  },\n  methods:{\n    initHistory(userId){\n        var seaHis = window.sessionStorage.getItem('seaHis') ? JSON.parse(window.sessionStorage.getItem('seaHis')) : '';\n        if(seaHis == '' || seaHis == 'undefined'){\n            return;\n        }else{\n            this.showHistory(userId);\n        }\n    },\n    toDetail(videoId){\n        var obj ={}\n        if(this.userInfo.userId){//userId存在，说明用户已登录\n            obj = {userId: this.userInfo.userId, name: this.query};\n        }else{//userId不存在，说明用户是游客状态\n            obj ={userId: 'tourists', name: this.query}\n        }\n        //点击搜索结果时判断是否存储搜索记录\n        var seaHis = JSON.parse(window.sessionStorage.getItem('seaHis')) || '';\n        //定义是否存储状态 true：存储 \n        var isStorage = true;\n        var arr = [];\n        \n        for(var key in seaHis){\n            //搜索记录相同时 存储状态改为false\n            if(seaHis[key].name == obj.name){\n                isStorage = false;\n                break;\n            }\n            arr.push(seaHis[key])\n        }\n        //根据存储状态来判断是否存储\n        if(isStorage){\n            arr.unshift(obj);\n            window.sessionStorage.setItem('seaHis',JSON.stringify(arr));\n        }\n        this.$router.push({path:'/detail', query: {id: videoId}})\n\n    },\n    showHistory(userId){\n        // console.log('showHistory  id= ' + userId)\n        var searchHistory = JSON.parse(window.sessionStorage.getItem('seaHis'));\n        var arr = [];\n        for(var key in searchHistory){\n            if(searchHistory[key].userId === userId){\n                arr.push(searchHistory[key])\n            }\n        }\n        this.seaHis = arr;\n\n    },\n    historyHandler(name){\n        this.query = name;\n    },\n    delHistory(){\n        this.$refs.myConfirm.showModel();\n        this.confirmOptions= {\n            type: \"warning\",//warning\n            message: \"是否删除搜索历史？\",//\"\"\n            btnSubmitFunction: ()=> {\n               window.sessionStorage.removeItem('seaHis');\n               this.showHistory();\n            },\n            btnCancelFunction: function () {\n                \n            }\n        }\n        \n        \n    },\n    onCancle(){\n        this.$router.go(-1);\n    }\n\n  }\n};\n",null]}